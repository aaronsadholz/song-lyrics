---
title: "R Notebook"
output: html_notebook
---

# Distance-based comparisons

One of the things we are interested on is to find which observations are more similar/different to each other. Using the word embeddings representation of
our data, we computed pairwise euclidean distance between observations at different levels to find similar elements.

Since we have more than 200,000 songs it is hard to visualize them all at once, so we need to group them in some way. For this part we decided to group based on the following columns: year, genre and artist name. When grouping songs, we took the mean of the group to represent it.

```{r}
library(feather)
library(dplyr)
library(tidyr)
library(reshape2)
library(ggplot2)
source('experiments/eduardo/util.R')
```

```{r}
# load embeddings data data and
df <- read_feather('data/transform/embeddings.feather')
bow <- read_feather('data/transform/bag_of_words.feather')

# get columns corresponding to the metadata words
columns <- colnames(df)
columns_metadata <- columns[endsWith(columns, '_')]
columns_lyrics <- columns[!endsWith(columns, '_')]

bow_columns <- colnames(bow)
bow_columns_metadata <- bow_columns[endsWith(columns, '_')]
bow_columns_lyrics <- bow_columns[!endsWith(columns, '_')]
```

# Comparing years

We first take a look at the distance between years:

```{r}
by_year_en <- df %>% group_by(release_year_) %>%
                 do(mean_words(., columns_lyrics))
plot_matrix(by_year_en)
```

We see that for any given year, the more we move (either to following or previous years) the distance increases. We can see that the greatest distance is between the latest data (2000s) and the earliest data (1920s).

## Comparing genres

We have `r length(unique(df$genre_))` different genres in the data, so in order to visualize better we filtered by the most popular genres defined as the ones with more than 80 songs.

```{r}
# get only genres that have more than 80 songs
genre_ <- table(df$genre_)
top_genres <- names(genre_[genre_ > 80])

top_genres
```

```{r}
by_genre <- df %>% filter(genre_ %in% top_genres) %>% group_by(genre_) %>%
                do(mean_words(., columns_lyrics))

plot_matrix(by_genre)
```

We see that some rows are very different to the rest: Samba, Reggaeton, MPB ([MÃºsica popular brasileira](https://en.wikipedia.org/wiki/M%C3%BAsica_popular_brasileira)), Latin, Flamenco and Bachata. Most songs from these songs are in either Spanish or Portuguese, so it makes sense that they make use of different words.

We not filter by songs only in Spanish.

```{r}
by_genre_es <- df %>% filter(genre_ %in% top_genres, language_ == 'es') %>%
                    group_by(genre_) %>% do(mean_words(., columns_lyrics))

plot_matrix(by_genre_es)
```

This plot is more informative, we see that Trance and House songs in Spanish are the genres that are most different to the rest.

We now take a look at music in English.

```{r}
by_genre_en <- df %>% filter(genre_ %in% top_genres, language_ == 'en') %>%
                    group_by(genre_) %>% do(mean_words(., columns_lyrics))

plot_matrix(by_genre_en)
```

Here we see that Samba, Reggaeton and Bachata are the genres that are different, songs from those three genres are usually not in English, which
suggests that our language imputation algorithm is having trouble labeling
those songs.

```{r}
reggaeton <- df %>% filter(genre_ == 'Reggaeton')
table(reggaeton$language_)


x <- bow %>% filter(genre_ == 'Reggaeton', language_ == 'en')

data.frame(x)

x$title_
x$artist_name_

bow_columns_lyrics[x[1, bow_columns_lyrics] > 0]
```

```{r}
reggaeton_en <- df %>% filter(genre_ == 'Reggaeton', language_ == 'en')

reggaeton_en[c('title_', 'artist_name_')]
```


## Finding similar artists

```{r}
reggaeton <- df %>% filter(genre_ == 'Reggaeton')

by_artist <- reggaeton %>% group_by(artist_name_) %>%
                do(mean_words(., columns_lyrics))

plot_matrix(by_artist)
```

```{r}
sub <- df %>% filter(genre_ == 'Rock') %>% sample_n(50)

unique(sub$artist_name_)

by_artist <- sub %>% group_by(artist_name_) %>% do(mean_words(., columns_lyrics))

plot_matrix(by_artist)
```


# Comparing songs form the same artist

```{r}
oasis <- df %>% filter(artist_name_ == 'Oasis') %>% sample_n(30)
oasis <- oasis[c('title_', columns_lyrics)]
plot_matrix(oasis)
```


```{r}
deep purple <- df %>% filter(artist_name_ == 'Deep Purple') %>% sample_n(30)
deep purple <- deep purple[c('title_', columns_lyrics)]
plot_matrix(deep purple)
```

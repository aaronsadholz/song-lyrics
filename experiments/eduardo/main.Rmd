---
title: "R Notebook"
output: html_notebook
---

# Distance-based comparisons

One of the things we are interested on is to find which observations are more similar/different to each other. Using the word embeddings representation of
our data, we computed pairwise euclidean distance between observations at different levels to find similar elements.

Since we have more than 200,000 songs it is hard to visualize them all at once, so we need to group them in some way. For this part we decided to group based on the following columns: year, genre and artist name. When grouping songs, we took the mean of the group to represent it.

```{r}
library(feather)
library(dplyr)
library(tidyr)
library(reshape2)
library(ggplot2)
source('experiments/eduardo/util.R')
```

```{r}
# load embeddings data data and
df <- read_feather('data/transform/embeddings.feather')

# get columns corresponding to the metadata words
columns <- colnames(df)
columns_metadata <- columns[endsWith(columns, '_')]
columns_lyrics <- columns[!endsWith(columns, '_')]
```

# Finding similar years


```{r}
by_year_en <- df %>% group_by(release_year_) %>%
                 do(mean_words(., columns_lyrics))
plot_matrix(by_year_en)
```

## Finding similar genres


```{r}
# get only genres that have more than 80 songs
genre_ <- table(df$genre_)
top_genres <- names(genre_[genre_ > 80])

by_genre <- df %>% filter(genre_ %in% top_genres) %>% group_by(genre_) %>%
                do(mean_words(., columns_lyrics))

plot_matrix(by_genre)
```

```{r}
by_genre_es <- df %>% filter(genre_ %in% top_genres, language_ == 'es') %>%
                    group_by(genre_) %>% do(mean_words(., columns_lyrics))

plot_matrix(by_genre_es)
```

```{r}
by_genre_en <- df %>% filter(genre_ %in% top_genres, language_ == 'en') %>%
                    group_by(genre_) %>% do(mean_words(., columns_lyrics))

plot_matrix(by_genre_en)
```

```{r}
reggaeton <- df %>% filter(genre_ == 'Reggaeton')
table(reggaeton$language_)

reggaeton_en <- df %>% filter(genre_ == 'Reggaeton', language_ == 'en')

reggaeton_en[c('title_', 'artist_name_')]
```


## Finding similar artists

```{r}
reggaeton <- df %>% filter(genre_ == 'Reggaeton')

by_artist <- reggaeton %>% group_by(artist_name_) %>%
                do(mean_words(., columns_lyrics))

plot_matrix(by_artist)
```

```{r}
sub <- df %>% filter(genre_ == 'Rock') %>% sample_n(50)

unique(sub$artist_name_)

by_artist <- sub %>% group_by(artist_name_) %>% do(mean_words(., columns_lyrics))

plot_matrix(by_artist)
```


# Comparing songs form the same artist

```{r}
oasis <- df %>% filter(artist_name_ == 'Oasis') %>% sample_n(30)
oasis <- oasis[c('title_', columns_lyrics)]
plot_matrix(oasis)
```


```{r}
deep purple <- df %>% filter(artist_name_ == 'Deep Purple') %>% sample_n(30)
deep purple <- deep purple[c('title_', columns_lyrics)]
plot_matrix(deep purple)
```
